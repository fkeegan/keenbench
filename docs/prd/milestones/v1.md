# PRD: v1 Milestone

## Status
Draft

## Goal
Deliver a sellable v1 of KeenBench with safe, reviewable AI work inside Workbenches, covering Workshop with Draft/Publish, review, checkpoints, and multi-model support.

## In Scope
- Workbench with explicit file add (copy) and sandboxed scope
- Workshop mode (interactive chat) with Draft application, review, and message-level undo
- Draft vs Published states with publish/discard (one Draft at a time)
- Review UX: file list + diffs for text, summaries + in-app before/after preview for non-text files
- Checkpoints and restore
- Multi-model support: user/workbench defaults, seamless model switching in Workshop
- Workshop conversation saved per Workbench and restored on reopen
- Clutter Bar (context health indicator)
- First-run walkthrough with a sample Workbench
- Accessibility baseline for v1 core flows (WCAG 2.1 AA targets)
- Network egress and upload guardrails (configured providers only; explicit consent before provider upload; no URL fetching in v1)

## File Constraints
- **Max files per Workbench**: 10
- **Max file size**: 25 MB per file
- **Supported types**: Text (.md, .txt, .csv, .json, .xml, .yaml, .html), Code files, Documents (.docx, .odt, .pdf), Presentations (.pptx), Spreadsheets (.xlsx), Images (.png, .jpg, .jpeg, .gif, .svg, .webp)
- Archives (.zip) and unsupported types treated as opaque binaries

## Out of Scope
- Cloud sync or team collaboration features
- Connectors (Drive/Notion/email/calendar)
- Full semantic diffs for Office files
- Workflow templates for common job types
- Marketplace / third-party workflow store
- "Try with another model" fork for Workshop responses (deferred to v1.5)
- Concurrent Drafts (deferred to v1.5)
- Local/offline model support
- Multiple concurrent Workbenches
- Workbench archive export (.zip)

## User Flows
- Create Workbench -> add files -> see scope notice
- First run -> sample Workbench -> scope + Draft/Published explainer -> run a small job
- Workshop: prompt -> AI responds -> auto-applied draft changes -> review diff -> publish or discard
- Workshop: switch model -> new model picks up conversation history -> continue
- Restore checkpoint -> Workbench rewound to prior state

## Requirements
1. Workbenches are explicit, copy-based, and restrict AI I/O to Workbench scope.
2. Egress is limited to configured providers; users explicitly confirm provider(s) and file scope before the first model call per Workbench; URL fetching is not supported in v1.
3. Draft/Published separation with atomic publish and discard; one Draft at a time.
4. Review UI supports text diffs and binary summaries with in-app before/after preview.
5. Auto-checkpoints before publish/restore and restore UX for rollbacks.
6. Workshop supports incremental changes, Draft application, and message-level undo.
7. Workshop conversation is saved per Workbench and restored on reopen.
8. Model switching in Workshop: new model picks up conversation history, no confirmation.
9. File limits are enforced (10 files max, 25 MB per file).
10. Clutter Bar shows context health based on file count, file weight, and conversation history.
11. First-run walkthrough introduces scope, Draft vs Published, and review workflow.
12. Accessibility baseline for v1 core flows meets WCAG 2.1 AA targets.

## Acceptance Criteria
- Creating a Workbench never reads outside user-selected add paths and shows scope messaging.
- File limits are enforced at add time with clear user feedback.
- Publishing applies all Draft changes atomically; discarding removes Draft changes.
- Starting a new session while a Draft exists prompts: Publish, Discard, or Cancel.
- Review screen lists changed files and shows diffs for text files.
- Non-text changes show a summary and allow in-app before/after preview.
- Restore returns the Workbench to a prior checkpoint without manual file edits.
- Restore "goes back in time": restoring a checkpoint rewinds Published files and Workbench history (conversation records).
- Workshop conversation is restored when reopening the Workbench.
- Users can revert Workshop conversation to a previous message.
- Model switch in Workshop is seamless; new model continues from conversation history.
- Users explicitly confirm provider(s)/model(s) and file scope before model calls; URL fetching is not available in v1; jobs never call unconfigured providers.
- Network interruptions preserve conversation state and allow resume.
- Clutter Bar is visible and updates as files/conversation grow.
- First-run walkthrough is shown once and can be re-opened from Help.
- Accessibility: keyboard navigation, screen reader labels for core flows, and sufficient contrast are verified for v1.

## Dependencies
- Model provider integrations (at least two or BYOK abstraction)
- Egress policy enforcement and consent UI for provider uploads
- Draft/checkpoint storage implementation
- Diff viewer for text files + binary preview hooks
- Clutter Bar calculation logic (file indexing by type/size + conversation token estimation)

## Telemetry
- % of users who create a Workbench and run a job within 10 minutes
- % of jobs that reach Publish (Draft acceptance rate)
- Model switch frequency in Workshop

## Risks / Open Questions
~~What minimal binary summary format is "good enough" for trust?~~ → **Removed**: Already defined in review tiers (before/after preview + AI summary). Not a separate decision.

~~What is the fallback when a provider is unavailable mid-session?~~ → **Resolved**: Retry 3 times with exponential backoff. If problem persists, show error and offer option to switch provider.
